<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paintee.common.repository.helper.RewardHelper">
  
    <resultMap id="BaseResultMap" type="com.paintee.common.repository.entity.vo.RewardVO" extends="com.paintee.common.repository.mapper.UserMapper.BaseResultMap">
        <result column="remain_money" property="remainMoney" />
        <result column="sell_count" property="sellCount" />
        <result column="request_count" property="requestCount" />
	</resultMap>
    
  	<select id="selectRewardInfo" resultMap="BaseResultMap" parameterType="com.paintee.common.repository.entity.User">
	    SELECT a.earn_total_money,
			   a.earn_reword_money,
			   a.earn_total_money - a.earn_reword_money AS remain_money,
			   (SELECT COUNT(*)
			      FROM tb_purchase a, tb_painting b
			     WHERE a.painting_id = b.painting_id
			       AND b.artist_id = #{userId}) as sell_count,
			   (SELECT count(*) 
			      FROM TB_REWARD
			     WHERE reward_status = 'R'
			       AND user_id = #{userId}) as request_count
		  FROM tb_user a 
		 where a.user_id = #{userId}
  	</select>
</mapper>