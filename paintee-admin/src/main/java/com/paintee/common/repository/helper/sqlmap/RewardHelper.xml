<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paintee.common.repository.helper.RewardHelper">
  
    <resultMap id="BaseResultMap" type="com.paintee.common.repository.entity.vo.RewardVO" extends="com.paintee.common.repository.mapper.UserMapper.BaseResultMap">
        <result column="remain_money" property="remainMoney" />
        <result column="sell_count" property="sellCount" />
	</resultMap>
    
  	<select id="selectRewardInfo" resultMap="BaseResultMap" parameterType="com.paintee.common.repository.entity.User">
		select a.earn_total_money, 
			   a.earn_reword_money,  
			   a.earn_total_money - a.earn_reword_money as remain_money, 
			   b.sell_count 
		  from tb_user a, (select count(*) sell_count, b.artist_id 
							 from tb_purchase a, 
							      tb_painting b
							where a.painting_id = b.painting_id
							  and b.artist_id = #{userId}
						 group by b.artist_id) b
		 where a.user_id = b.artist_id
  	</select>

</mapper>