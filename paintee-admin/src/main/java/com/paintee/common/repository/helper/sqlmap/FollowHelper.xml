<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paintee.common.repository.helper.FollowHelper">
	<resultMap id="BaseResultMap" type="com.paintee.common.repository.entity.vo.FollowVO" extends="com.paintee.common.repository.mapper.PaintingMapper.BaseResultMap">
	    <result column="sentence_name" property="sentenceName" />
	    <result column="follows_count" property="followsCount" />
	    <result column="following_count" property="followingCount" />
	</resultMap>
  	
	<!-- 로그인 사용자가 팔로잉한 사용자가 구매한 그림과 업로드한 그림의 목록을 가져오기 -->
  	<select id="selectFollowPaintingList" resultMap="BaseResultMap">
		select a.artist_id, 
			   (select name from tb_user where user_id = a.artist_id) artist_name, 
			   (select name from tb_user where user_id = a.artist_id) sentence_name, 
			   a.sentence, 
			   a.file_group_seq, 
			   a.upload_date, 
			   a.painting_id, 
			   a.posted_num, 
			   a.posted_people_cnt
		  from tb_painting a
		 where a.artist_id in (select following from tb_follow where user_id = #{userId})
		 union all
		select a.artist_id, 
			   (select name from tb_user where user_id = a.artist_id) artist_name, 
		       (select name from tb_user where user_id = b.user_id) sentence_name,
			   b.sentence,
			   a.file_group_seq,
			   b.purchase_date,
			   a.painting_id,
			   a.posted_num,
			   a.posted_people_cnt
		  from tb_painting a, 
		       tb_purchase b
		 where a.painting_id = b.painting_id
    	   and b.private_at = #{privateAt}
		   and b.purchase_status in <foreach item="status" collection="purchaseStatusList" open="(" close=")" separator=",">
		    							#{status}
		                            </foreach>
		   and b.user_id in (select following from tb_follow where user_id = #{userId})
		 order by upload_date desc
		 limit #{startRow}, #{rowPerPage}
  	</select>  	
  	
	<!-- 로그인 사용자가 팔로잉한 사용자가 구매한 그림과 업로드한 그림의 목록을 가져오기 -->
  	<select id="selectFollowCount" resultMap="BaseResultMap">
  	     select (select count(*) from tb_follow where user_id = #{userId}) as following_count,
  	            (select count(*) from tb_follow where following = #{userId}) as follows_count
           from dual
  	</select>    	
</mapper>